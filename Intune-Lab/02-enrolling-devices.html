<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Enrolling Devices - techbook</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">techbook</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="previous-1-setting-up-the-lab"><a class="header" href="#previous-1-setting-up-the-lab">Previous: [[1. Setting Up The Lab]]</a></h1>
<h1 id="getting-the-hardware-hash"><a class="header" href="#getting-the-hardware-hash">Getting the Hardware Hash</a></h1>
<p>In a real world scenario hardware hashes for each device would be provided to the organization by the device manufacturer, but since I can't do that I had to fake it a bit.</p>
<p>I created a new Windows 11 VM and when it got to the select region screen I pressed Shift+F10 to open command prompt then ran the command <code>powershell</code> to get to open a new PowerShell session.</p>
<p>The commands below do the following things:</p>
<ul>
<li>Installs Microsoft Graph</li>
<li>Connects to Microsoft Graph using the TenantID provided</li>
<li>Sets Execution Policy to Bypass</li>
<li>Installs Windows Autopilot Info module</li>
<li>Generates the device hardware hash and uploads it to the tenant</li>
</ul>
<pre><code>Set-ExecutionPolicy -Scope Process Bypass -Force
Install-Module Microsoft.Graph -Scope CurrentUser
Connect-MgGraph -Scopes "Group.ReadWrite.All" -TenantID "&lt;Your Tenant ID&gt;"
Install-Script -Name Get-WindowsAutopilotInfo -Force
Get-WindowsAutopilotInfo -Online
</code></pre>
<p><img src="attachments/02-enrolling-devices-1.png" alt="PowerShell command prompt installing Autopilot modules" /></p>
<p>To confirm this was successful you can go to Intune &gt; Devices &gt; Enrollment &gt; Windows Autopilot &gt; Devices</p>
<p><img src="attachments/02-enrolling-devices-2.png" alt="Windows Autopilot devices list in Intune" /></p>
<p>Here I can see my VM running on VMware "hardware". With this in place I'm ready to move on.</p>
<h1 id="creating-autopilot-device-group"><a class="header" href="#creating-autopilot-device-group">Creating Autopilot Device Group</a></h1>
<p>I created a Dynamic Security group called All-Registered-Autopilot that will grab all devices registered to Autopilot. This will be the group I assign the Deployment Profile and Enrollment Status Page to.</p>
<p>Intune &gt; Groups &gt; New Group</p>
<ul>
<li><strong>Name</strong>: All-Registered-Autopilot</li>
<li><strong>Description</strong>: All Devices registered to Autopilot</li>
<li><strong>Membership Type</strong>: Dynamic Device</li>
</ul>
<p>Edit Dynamic Query &gt; Configuration Rules</p>
<pre><code>(device.devicePhysicalIds -any (_ -startsWith "[ZTDId]"))
</code></pre>
<h1 id="creating-the-deployment-profile"><a class="header" href="#creating-the-deployment-profile">Creating The Deployment Profile</a></h1>
<p>My goal is to get a Windows 11 device to the point it could be purchased from the manufacturer, sent to a new employee, then the employee can use their corporate login credentials to sign in and set up the laptop. The configuration should take care of all setup and installs and leave as little as possible to the user.</p>
<p>I went to Intune &gt; Devices &gt; Enrollment &gt; Windows &gt; Deployment Profiles &gt; Create Profile</p>
<p>I gave the following settings to create the profile:</p>
<ul>
<li><strong>Name</strong>: Employee New Device</li>
<li><strong>Description</strong>: Windows 11 Employee Config</li>
<li><strong>Deployment Mode</strong>: User-Driven</li>
<li><strong>Joint to Microsoft Entra ID as</strong>: Microsoft Entra Joined</li>
<li><strong>Apply a device name template</strong>: Yes - <code>%SERIAL%-W</code></li>
<li><strong>Add Groups</strong>: All-Registered-Autopilot</li>
</ul>
<p>Summary of the Out-of-box experience (OOBE) settings</p>
<p><img src="attachments/02-enrolling-devices-3.png" alt="Deployment profile OOBE settings summary" /></p>
<h1 id="creating-an-enrollment-status-page-esp"><a class="header" href="#creating-an-enrollment-status-page-esp">Creating an Enrollment Status Page (ESP)</a></h1>
<p>Next I needed to create an Enrollment Status Page to prevent the user from affecting the device setup and also provide them visibility into the setup status.</p>
<p>To access the ESP settings I went to Intune &gt; Devices &gt; Enrollment &gt; Windows &gt; Enrollment Status Page &gt; Create</p>
<p>I gave it a name to match the Configuration Profile and set <strong>Show app and profile configuration progress</strong> to Yes and left all other settings as default on this page. I also assigned it to apply to the All-Windows-11 group.</p>
<p>Summary of ESP Settings below:</p>
<p><img src="attachments/02-enrolling-devices-4.png" alt="Enrollment Status Page settings summary" /></p>
<p>The following settings are important here to make sure apps we install during setup finish before the computer is released to the user:</p>
<ul>
<li><strong>Block device use until all apps and profiles are installed</strong>: Yes</li>
<li><strong>Block device use until required apps are installed if they are assigned to the user/device</strong>: All</li>
</ul>
<h1 id="testing-out-of-box-experience-oobe"><a class="header" href="#testing-out-of-box-experience-oobe">Testing Out-of-box experience (OOBE)</a></h1>
<p>With the command prompt still open on the Windows VM, I ran the command below to shutdown the device and set it back to OOBE mode.</p>
<pre><code>%SystemRoot%\System32\Sysprep\Sysprep.exe /oobe /shutdown
</code></pre>
<p>Once it turned back on I noticed the setup was different. It was now asking for a Microsoft Work/School account immediately. I chose one of the accounts from my organization at random and used their email address and password to login.</p>
<p>I noticed there were a few things I did not like about the OOBE setup. It asked the user to change their password as soon as they logged in. This may have been due to this being the first time they have ever logged in, or it could be set by Autopilot. I will need to look into this.</p>
<p>I also noticed it pushed the user into setting up a Windows Hello pin and then used that for login. I would instead prefer the user to have to use a domain user and password for login.</p>
<p>Lastly, I noticed it asked if the user wanted Microsoft 365 Copilot added to taskbar. I do not want my users to have this, or the question asking about it so I want to look into how to remove it.</p>
<h1 id="next-3-polishing-oobe"><a class="header" href="#next-3-polishing-oobe">Next: [[3. Polishing OOBE]]</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../Intune-Lab/01-setting-up-the-lab.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../Intune-Lab/03-polishing-oobe.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../Intune-Lab/01-setting-up-the-lab.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../Intune-Lab/03-polishing-oobe.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
