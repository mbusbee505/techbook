<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Securing Devices - techbook</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">techbook</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="previous-5-creating-update-rings"><a class="header" href="#previous-5-creating-update-rings">Previous: [[5. Creating Update Rings]]</a></h1>
<h1 id="introduction-to-security"><a class="header" href="#introduction-to-security">Introduction to Security</a></h1>
<p>One benefit of managing devices with Intune is that it gives you control of security features across the devices it manages and allows IT admins the ability to fine-tune their environments to meet their security and compliance needs. There are several methods available such as security baselines, defender for endpoint, compliance policies, conditional access, etc. that can be used to our benefit.</p>
<p>Every organization will have different concerns when it comes to data governance, risk, compliance, regulation, and other requirements make demands on how things can be structured. Since there is no one-size-fits-all solution to security, this section is meant as more of a walkthrough of options available within Intune rather than a comprehensive list of air-tight security measures. As always with security, consider your own threat model and how it applies to the resources available.</p>
<h1 id="security-baselines"><a class="header" href="#security-baselines">Security Baselines</a></h1>
<p>Conveniently, Microsoft created a way for administrators to change granular security settings that can be saved as templates called Security Baselines.</p>
<p>To access Security Baselines just go to <code>Intune &gt; Endpoint security &gt; Security Baselines &gt; Security Baseline for Windows 10 and later &gt; Create policy</code>. Most of the recommended defaults Microsoft gives us are pretty good so generally it is good enough to keep what is already in there but this would be the place to go for granular changes.</p>
<ul>
<li><strong>Name</strong>: Windows 11 Baseline</li>
<li><strong>Description</strong>: Windows 11 Baseline</li>
<li><strong>Configuration Settings</strong>: Keep Defaults</li>
<li><strong>Assignments</strong>: All-Employees and All-Windows-11</li>
</ul>
<p><img src="attachments/06-securing-devices-1.png" alt="Security baseline configuration settings" /></p>
<p>Once you save this baseline the security settings chosen in Configuration Settings will be enforced on all users and Windows 11 devices. If we wanted to tweak these settings later on we could come back and change the settings or possibly create a new baseline and assign it to a different group of users or devices.</p>
<p>We could also consider, for testing purposes, limiting the rollout of this Security Baseline to our IT pilot users similar to howe we did with the Update Rings. This way we could ensure the baseline works correctly for non-critical users before pushing it out to all users.</p>
<h1 id="defender-for-endpoint"><a class="header" href="#defender-for-endpoint">Defender for Endpoint</a></h1>
<p>Microsoft Defender for Endpoint can be used as an Endpoint Detection and Response solution within your environment. You can create policies with Intune that onboard MDE to each device so you have visibility into the security of your devices.</p>
<p>Now go to <code>Defender &gt; Settings &gt; Endpoints &gt; Onboarding</code> where you can find the download button for the Onboarding package. Make sure to select "Mobile Device Management / Microsoft Intune" from the Deployment method dropdown first.</p>
<p><img src="attachments/06-securing-devices-3.png" alt="Defender onboarding package download screen" /></p>
<p>Clicking download will get you a file called <code>WindowsDefenderATP.onboarding</code> that can be uploaded into the Intune Portal.</p>
<p>To create a new onboarding policy go to <code>Intune &gt; Endpoint security &gt; Endpoint detection and response &gt; Create policy</code></p>
<blockquote>
<p>On this page Intune will also show you how many devices you currently do not have onboarded.
<img src="attachments/06-securing-devices-2.png" alt="Devices not onboarded count in Intune" /></p>
</blockquote>
<p>Now you will need to get the text from within the <code>WindowsDefenderATP.onboarding</code> file which Microsoft calls the Onboarding blob. You can open it in something standard like Notepad or VSCode and paste the entire thing in the field called Onboarding (Device) below. In the Create Profile wizard I added the following settings:</p>
<ul>
<li><strong>Platform</strong>: Windows</li>
<li><strong>Profile</strong>: Endpoint Detection and Response</li>
<li><strong>Name</strong>: EDR Onboarding</li>
<li><strong>Description</strong>: EDR Onboarding</li>
<li><strong>Microsoft Defender for Endpoint client configuration package type</strong>: Onboarding</li>
<li><strong>Onboarding (Device)</strong>: Onboarding blob</li>
<li><strong>Sample Sharing</strong>: All (Default)</li>
<li><strong>Assignment</strong>: All-Windows-11 Include</li>
</ul>
<p>It took some time for the settings to sync but after a bit I came back and saw I had one onboarded device and two successful device checkins.</p>
<p><img src="attachments/06-securing-devices-4.png" alt="EDR onboarding status showing one onboarded device" /></p>
<p><img src="attachments/06-securing-devices-5.png" alt="Successful device checkins to MDE" /></p>
<p>This means that Intune is successfully connected to MDE and onboarded to the EDR. Intune is now able to push security profiles to devices it manages as well as pull status reports from them.</p>
<h1 id="compliance-policies"><a class="header" href="#compliance-policies">Compliance Policies</a></h1>
<p>Compliance policies in Intune can be used as a way to enforce that certain security features are required on devices assigned to the policy. For instance you can require devices use BitLocker and Secure Boot to be marked compliant. Compliance policies can also send emails to the user that has a device marked non-compliant.</p>
<p>Before we create a policy, let's create a template we can use later for the email we will send to users. To create a new template go to <code>Intune &gt; Devices &gt; Compliance &gt; Notifications &gt; Create Notification</code>. Below are the settings I used:</p>
<p><strong>Name</strong>: Non-Compliance Email
<strong>Show company logo</strong>: Enable
<strong>Show company name</strong>: Enable
<strong>Locale</strong>: English (United States)
<strong>Subject</strong>: Device is Noncompliant
<strong>Message</strong>:</p>
<pre><code>Hello,

Your device has been marked noncompliant. Please call the IT department at 555-555-5555 to resolve this issue.
</code></pre>
<p><strong>Set to default locale</strong>: Toggled On</p>
<p><img src="attachments/06-securing-devices-9.png" alt="Non-compliance email notification template settings" /></p>
<p>Now that we have an email template to send to users we can create the Compliance Policy by going to <code>Intune &gt; Devices &gt; Compliance &gt; Create Policy</code> and entering the following policy settings:</p>
<p><strong>Platform</strong>: Windows 10 and later
<strong>Profile type</strong>: Windows 10/11 compliance policy
<strong>Name</strong>: Win Compliant – BitLocker + Secure Boot + MDE Healthy
<strong>Description</strong>: Marks Windows devices compliant only if disk encryption, secure-boot &amp; Defender for Endpoint health are all good.</p>
<p>On the next page you can choose security settings to be required for compliance at the granular level. Microsoft separates them into categories so you will need to browse through the options.</p>
<p><img src="attachments/06-securing-devices-8.png" alt="Compliance policy settings categories" /></p>
<p>Under the Device Health header you can find settings to require BitLocker and Secure Boot</p>
<p><img src="attachments/06-securing-devices-6.png" alt="Device Health settings requiring BitLocker and Secure Boot" /></p>
<p>Under the Microsoft Defender for Endpoint section you can find the option that requires devices report all clear on their machine risk score to be considered compliant.</p>
<p><img src="attachments/06-securing-devices-7.png" alt="Microsoft Defender for Endpoint machine risk requirements" /></p>
<p>Under the Actions for noncompliance page the policy will automatically set a rule to immediately mark the device as noncompliant but that can be delayed by a number of days. On the line underneath choose <code>send email to end user</code> with 0 days scheduled which will cause the email to send immediately. On the Choose template field, select the <code>Non-Compliance Email</code> template we created earlier.</p>
<p><img src="attachments/06-securing-devices-10.png" alt="Actions for noncompliance email configuration" /></p>
<p>There is also an option to select additional recipients of the email. We could choose to send this to a specific group of users such as the IT team. For now I will leave this blank.</p>
<p>I will assign this policy to the All-Windows-11 group and finish creating the policy. Now if you refresh the page on Compliance Policies it will warn you that we are not using Conditional Access to enforce the policy.</p>
<p><img src="attachments/06-securing-devices-11.png" alt="Warning about missing Conditional Access enforcement" /></p>
<p>This means we will need to move on to the next section where we will create a Conditional Access policy in Entra and connect it to the compliance policy.</p>
<h1 id="conditional-access-policy"><a class="header" href="#conditional-access-policy">Conditional Access Policy</a></h1>
<p>Conditional Access Policies can be set in Entra and be used for enforcing the Compliance Policy we created in the previous step. To create the policy go to <code>Entra &gt; Conditional Access &gt; Create new policy</code> and fill out the fields like below:</p>
<ul>
<li><strong>Name</strong>: M365 – Require compliant device</li>
<li><strong>Users</strong>: Include &gt; Select users and groups &gt; Users and groups &gt; All-Employees group</li>
<li><strong>Target Resources</strong>:
<ul>
<li><strong>Select what this policy applies to</strong>: Resources (formerly cloud apps)</li>
<li>Include &gt; Select resources &gt; Select &gt; Office365</li>
</ul>
</li>
<li><strong>Network</strong>: No but here is where we could block based on network connection details</li>
<li><strong>Grant</strong>: Grant access &gt; Require device to be marked as compliant</li>
<li><strong>Enable Policy</strong>: Report-only (test first before locking yourself out).</li>
</ul>
<p>Click create to finish out the policy wizard.</p>
<p><img src="attachments/06-securing-devices-12.png" alt="Conditional Access policy requiring compliant device" /></p>
<p>Report-only will just create logs but not actually lock you out so you can test for a few times. You can verify the sign-in logs by going to <code>Entra &gt; Monitoring &amp; health &gt; Sign-in logs</code> and take a look at your logs while this policy is in Report-only mode.</p>
<p><img src="attachments/06-securing-devices-13.png" alt="Sign-in logs showing successful conditional access" /></p>
<p>Since my sign-ins though the online portal are showing as a Success it looks like its okay to turn the policy on for real. Your mileage may vary. This is why testing is important.</p>
<p>Next up we want to create another policy to block legacy authentication. Go to <code>Entra &gt; Conditional Access &gt; Create new policy</code> and enter the following details:</p>
<p><strong>Name</strong>: Block legacy authentication – All users
<strong>Assignments</strong>: All Users
<strong>Conditions</strong>: Client Apps &gt; Yes &gt; Other clients
<strong>Grant</strong>: Block access
<strong>Enable</strong>: Report-only to test then On</p>
<p><img src="attachments/06-securing-devices-14.png" alt="Conditional Access policy blocking legacy authentication" /></p>
<p>In my Intune Devices list I can confirm one of my devices is non-compliant. It is currently not using BitLocker or Secure Boot.</p>
<p><img src="attachments/06-securing-devices-15.png" alt="Device list showing non-compliant device status" /></p>
<p>Since these two failure points are things we would want to have setup before we ever ship devices to users I won't worry about fixing this now. It does at least show as a proof-of-concept that we can build compliance policies in Intune and use Entra to apply them with conditional access policies.</p>
<h1 id="next-7-enrolling-iphones"><a class="header" href="#next-7-enrolling-iphones">Next: [[7. Enrolling iPhones]]</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../Intune-Lab/05-creating-update-rings.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../Intune-Lab/07-enrolling-iphones.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../Intune-Lab/05-creating-update-rings.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../Intune-Lab/07-enrolling-iphones.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
